name: Build+Test Pipeline

on:
  pull_request:
    branches:
      - dev

jobs:
  build-docker:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'

    - name: Get CMake
      uses: symbitic/install-cmake@master

    - name: Cache OpenCV
      uses: UrielCh/opencv-cache-action@V1
      with:
        branch: 4.x
        BUILD_LIST: core,imgproc,imgcodecs,videoio,highgui,video,calib3d,features2d,objdetect,dnn,ml,photo,gapi,python3
        NO_CONTRIB: ''


    - name: Install fyne deps
      run: sudo apt update && sudo apt install gcc libgl1-mesa-dev xorg-dev -y

    - name: Install and configure opencv
      run: export PKG_CONFIG_PATH="/usr/lib/pkgconfig" && echo "--Install--" && cd ../build && sudo make install && echo "--Config--" && sudo ldconfig

    

    #- name: Find include's
    #  run: find .. -type d -regextype posix-egrep -regex ".*include.*"

    #- name: Find lib's
    #  run: find .. -type d -regextype posix-egrep -regex ".*lib.?"



    - name: Test Build
      run: export CGO_CXXFLAGS="--std=c++11" && export CGO_CPPFLAGS="-I/home/max/Documents/Code/opencv/3rdparty/carotene/include -I/home/max/Documents/Code/opencv/3rdparty/flatbuffers/include -I/home/max/Documents/Code/opencv/3rdparty/include -I/home/max/Documents/Code/opencv/3rdparty/ittnotify/include -I/home/max/Documents/Code/opencv/3rdparty/openvx/include -I/home/max/Documents/Code/opencv/3rdparty/quirc/include -I/home/max/Documents/Code/opencv/include -I/home/max/Documents/Code/opencv/modules/calib3d/include -I/home/max/Documents/Code/opencv/modules/core/include -I/home/max/Documents/Code/opencv/modules/dnn/include -I/home/max/Documents/Code/opencv/modules/dnn/src/ocl4dnn/include -I/home/max/Documents/Code/opencv/modules/dnn/src/vkcom/include -I/home/max/Documents/Code/opencv/modules/features2d/include -I/home/max/Documents/Code/opencv/modules/flann/include -I/home/max/Documents/Code/opencv/modules/gapi/include -I/home/max/Documents/Code/opencv/modules/highgui/include -I/home/max/Documents/Code/opencv/modules/imgcodecs/include -I/home/max/Documents/Code/opencv/modules/imgproc/include -I/home/max/Documents/Code/opencv/modules/ml/include -I/home/max/Documents/Code/opencv/modules/objdetect/include -I/home/max/Documents/Code/opencv/modules/photo/include -I/home/max/Documents/Code/opencv/modules/stitching/include -I/home/max/Documents/Code/opencv/modules/ts/include -I/home/max/Documents/Code/opencv/modules/video/include -I/home/max/Documents/Code/opencv/modules/videoio/include -I/home/max/Documents/Code/opencv/modules/world/include -I/home/max/Documents/Code/opencv/platforms/android/aar-template/OpenCV/src/main/cpp/include -I/home/max/Documents/Code/opencv/platforms/semihosting/include -I/home/max/Documents/Code/opencv/samples/semihosting/include -I/home/max/Documents/Code/opencv_contrib/modules/alphamat/include -I/home/max/Documents/Code/opencv_contrib/modules/aruco/include -I/home/max/Documents/Code/opencv_contrib/modules/bgsegm/include -I/home/max/Documents/Code/opencv_contrib/modules/bioinspired/include -I/home/max/Documents/Code/opencv_contrib/modules/cannops/include -I/home/max/Documents/Code/opencv_contrib/modules/ccalib/include -I/home/max/Documents/Code/opencv_contrib/modules/cnn_3dobj/include -I/home/max/Documents/Code/opencv_contrib/modules/cudaarithm/include -I/home/max/Documents/Code/opencv_contrib/modules/cudabgsegm/include -I/home/max/Documents/Code/opencv_contrib/modules/cudacodec/include -I/home/max/Documents/Code/opencv_contrib/modules/cudafeatures2d/include -I/home/max/Documents/Code/opencv_contrib/modules/cudafilters/include -I/home/max/Documents/Code/opencv_contrib/modules/cudaimgproc/include -I/home/max/Documents/Code/opencv_contrib/modules/cudalegacy/include -I/home/max/Documents/Code/opencv_contrib/modules/cudaobjdetect/include -I/home/max/Documents/Code/opencv_contrib/modules/cudaoptflow/include -I/home/max/Documents/Code/opencv_contrib/modules/cudastereo/include -I/home/max/Documents/Code/opencv_contrib/modules/cudawarping/include -I/home/max/Documents/Code/opencv_contrib/modules/cudev/include -I/home/max/Documents/Code/opencv_contrib/modules/cvv/include -I/home/max/Documents/Code/opencv_contrib/modules/datasets/include -I/home/max/Documents/Code/opencv_contrib/modules/dnn_objdetect/include -I/home/max/Documents/Code/opencv_contrib/modules/dnn_superres/include -I/home/max/Documents/Code/opencv_contrib/modules/dpm/include -I/home/max/Documents/Code/opencv_contrib/modules/face/include -I/home/max/Documents/Code/opencv_contrib/modules/freetype/include -I/home/max/Documents/Code/opencv_contrib/modules/fuzzy/include -I/home/max/Documents/Code/opencv_contrib/modules/hdf/include -I/home/max/Documents/Code/opencv_contrib/modules/hfs/include -I/home/max/Documents/Code/opencv_contrib/modules/img_hash/include -I/home/max/Documents/Code/opencv_contrib/modules/intensity_transform/include -I/home/max/Documents/Code/opencv_contrib/modules/julia/include -I/home/max/Documents/Code/opencv_contrib/modules/line_descriptor/include -I/home/max/Documents/Code/opencv_contrib/modules/matlab/include -I/home/max/Documents/Code/opencv_contrib/modules/mcc/include -I/home/max/Documents/Code/opencv_contrib/modules/optflow/include -I/home/max/Documents/Code/opencv_contrib/modules/ovis/include -I/home/max/Documents/Code/opencv_contrib/modules/phase_unwrapping/include -I/home/max/Documents/Code/opencv_contrib/modules/plot/include -I/home/max/Documents/Code/opencv_contrib/modules/quality/include -I/home/max/Documents/Code/opencv_contrib/modules/rapid/include -I/home/max/Documents/Code/opencv_contrib/modules/reg/include -I/home/max/Documents/Code/opencv_contrib/modules/rgbd/include -I/home/max/Documents/Code/opencv_contrib/modules/saliency/include -I/home/max/Documents/Code/opencv_contrib/modules/sfm/include -I/home/max/Documents/Code/opencv_contrib/modules/shape/include -I/home/max/Documents/Code/opencv_contrib/modules/stereo/include -I/home/max/Documents/Code/opencv_contrib/modules/structured_light/include -I/home/max/Documents/Code/opencv_contrib/modules/superres/include -I/home/max/Documents/Code/opencv_contrib/modules/surface_matching/include -I/home/max/Documents/Code/opencv_contrib/modules/text/include -I/home/max/Documents/Code/opencv_contrib/modules/tracking/include -I/home/max/Documents/Code/opencv_contrib/modules/videostab/include -I/home/max/Documents/Code/opencv_contrib/modules/viz/include -I/home/max/Documents/Code/opencv_contrib/modules/wechat_qrcode/include -I/home/max/Documents/Code/opencv_contrib/modules/xfeatures2d/include -I/home/max/Documents/Code/opencv_contrib/modules/ximgproc/include -I/home/max/Documents/Code/opencv_contrib/modules/xobjdetect/include -I/home/max/Documents/Code/opencv_contrib/modules/xphoto/include -I/home/max/Documents/Code/build/3rdparty/ippicv/ippicv_lnx/icv/include -I/home/max/Documents/Code/build/3rdparty/ippicv/ippicv_lnx/iw/include -I/home/max/Documents/Code/build/3rdparty/ade/ade-0.1.2d/sources/ade/include -I/home/max/Documents/Code/build/include -I/home/max/Documents/Code/build" && export CGO_LDFLAGS="-L/home/max/Documents/Code/opencv/3rdparty/zlib -L/home/max/Documents/Code/opencv/modules/java/android_sdk/android_gradle_lib -L/home/max/Documents/Code/opencv/modules/java/android_sdk/android_lib -L/home/max/Documents/Code/opencv/modules/java/test/pure_test/lib -L/home/max/Documents/Code/opencv/samples/java/sbt/lib -L/home/max/Documents/Code/opencv_contrib/modules/ccalib -L/home/max/Documents/Code/opencv_contrib/modules/ccalib/include/opencv2/ccalib -L/home/max/Documents/Code/build/CMakeFiles/Export/lib -L/home/max/Documents/Code/build/3rdparty/ippicv/ippicv_lnx/icv/lib -L/home/max/Documents/Code/build/3rdparty/lib -L/home/max/Documents/Code/build/modules/.firstpass/ccalib -L/home/max/Documents/Code/build/lib -L/home/max/Documents/Code/build -lopencv_stitching -lopencv_superres -lopencv_videostab -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dpm -lopencv_face -lopencv_photo -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_optflow -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_dnn -lopencv_plot -lopencv_xfeatures2d -lopencv_shape -lopencv_video -lopencv_ml -lopencv_ximgproc -lopencv_calib3d -lopencv_features2d -lopencv_highgui -lopencv_videoio -lopencv_flann -lopencv_xobjdetect -lopencv_imgcodecs -lopencv_objdetect -lopencv_xphoto -lopencv_imgproc -lopencv_core" && go run -tags customenv ./cmd/yaac/main.go

    #- name: Build project with make
    #  run: make build

    #- name: Run tests
    #  run: make test
